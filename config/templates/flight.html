{% extends "layout.html" %}
{% block content %}
<center>
    <table><tr><td>
        <a href="./">
        <img src='{{url_for("static", filename="landrs_200.png")}}' width="100" alt="LANDRS">
        </a>
    </td><td>
        <h1>LANDRS Drone Data Buddy</h1>
    </td></tr>
</table>
<br>

<fieldset class="form-group">
    <legend>Flight Creation</legend>
    <form id='create_flight' action="{{ url_for('flight_create') }}" method='POST'>
        {% block form_contents %}

        <table><tr>
            <!--Loop-->
            {%- for boundary in boundarys %}
            {%- if boundary['order'] == 100  %}
            <!--Add hidden text to send the type-->
            <input type="hidden" id="{{ boundary['name'] }}_type" name="{{ boundary['name'] }}_type" value="{{ boundary['class'] }}">
            {%- if boundary['defaultValue'] %}
            <input type="hidden" id="{{ boundary['name'] }}" name="{{ boundary['name'] }}" value="{{ boundary['defaultValue'] }}">
            {%- endif %}
            {%- else %}
            <td>{{ boundary['description'] }}:</td>
            <td>
                {%- if boundary['in']  %}
                <select class="form-control" style="width:auto;" data-property-id="{{ boundary['name'] }}" name="{{ boundary['name'] }}" >
                    {%- for inst in boundary['in'] %}
                    <option value="{{ inst['uri'] }}"
                    {%- if boundary['defaultValue'] == inst['uri'] %} selected
                        {%- endif %}
                    >{{ inst['label'] }}</option>
                    {%- endfor %}
                </select>
                {%- else %}
                <input type="text" placeholder="{{ boundary['defaultValue'] }}" class="form-control" id="{{ boundary['name'] }}" data-property-id="{{ boundary['name'] }}" name="{{ boundary['name'] }}" required>
                {%- endif %}
                {%- if boundary['class']  %}
                <!--Add hidden text to send the type-->
                <input type="hidden" id="{{ boundary['name'] }}_type" name="{{ boundary['name'] }}_type" value="{{ boundary['class'] }}">
                {%- else %}
                <!--Add hidden text to send the type-->
                <input type="hidden" id="{{ boundary['name'] }}_type" name="{{ boundary['name'] }}_type" value="{{ boundary['datatype'] }}">
                {%- endif %}
            </td>
        </tr><tr>
            {%- endif %}
            {%- endfor %}

            <td></td>
            <td>
                <input class="btn btn-secondary" name='create flight' type='submit' value='create flight' />
            </td>
        </tr></table>

        {% endblock %}
    </form>
    <div id='server-results'>Status: </div>
</fieldset>

</center>    
{% endblock %}
{% block scripts %}

<script type="text/javascript">

    $("#create_flight").submit(function(event){
        event.preventDefault(); //prevent default action 
        var post_url = $(this).attr("action"); //get form action url
        var request_method = $(this).attr("method"); //get form GET/POST method
        var form_data = $(this).serialize(); //Encode form elements for submission
        
        $.ajax({
            url : post_url,
            type: request_method,
            data : form_data
        }).done(function(response){ //
            console.log('Status: '+response.status)
            if(response.status == 'OK'){
                alert('Flight created,\nFlight id: \t\t' + response.flt_id + '\nCollection id: \t' + response.oc_id + '\nSensor id: \t\t' + response.sensor_id + '.');
            }else{
                alert('Error creating flight,\n' + response.status);
            }
            $("#server-results").html(response.status);
            alert('Error - ' + errorMessage);
        }).fail(function(xhr, status, error){ //
            var errorMessage = xhr.status + ': ' + xhr.statusText
            console.log('Error - ' + errorMessage + ',' + status + ',' + error);
            alert('Error - ' + errorMessage);
        });
    });

</script>

{% endblock %}